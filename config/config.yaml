# === anti-echo-chamber project config (v3: hybrid stance inference, FLAN-T5, CUDA 12.1) ===
version: 3

# === Hugging Face dataset for artifact storage ===
hf_dataset_id: "zanimal/anti-echo-artifacts"

# === Local Chroma collections ===
chroma_collections:
  topic: "news_topic"
  stance: "news_stance"

# === Embedding models ===
embeddings:
  topic_model: "intfloat/e5-base-v2"                 # strong topic model (dense retrieval)
  stance_model: "Snowflake/snowflake-arctic-embed-l" # ideology-aware stance encoder
  dim: 1024                                          # stance embedding dimensionality
  dtype: "float16"                                   # efficient precision for Chroma
  pooling: "mean"
  chunk_tokens: 512
  normalize: true

# === Topic inference ===
topics:
  source: "https://raw.githubusercontent.com/AHMerrill/anti-echo-chamber/main/config/topics.json"
  max_topics_per_article: 5
  similarity_threshold: 0.4

# === Stance summarization and ideological mapping ===
stance_processing:
  mode: "hybrid"                                     # hybrid = label + summary embeddings
  variants: ["label", "summary"]                     # two stance representations per article
  summarizer_model: "google/flan-t5-large"           # instruction-tuned model (replaces BART)
  target_sentences: 2                                # concise 1â€“2 sentence analytical summaries
  truncation: 3072                                   # input window in characters
  ideological_guidance:
    political_leanings: "https://raw.githubusercontent.com/AHMerrill/anti-echo-chamber/main/config/political_leanings.json"
    implied_stances: "https://raw.githubusercontent.com/AHMerrill/anti-echo-chamber/main/config/implied_stances.json"
  prompt_style:
    type: "constrained"
    description: >
      FLAN-T5 instruction prompt that forces a discrete choice of political
      leaning and implied stance from predefined JSON anchors before generating
      a short rhetorical summary. Designed for stance polarity and contrastive retrieval.

# === Batch artifact management ===
batch:
  base_dir: "batches"
  manifest_name: "manifest.json"
  topic_file: "embeddings_topic.npz"
  stance_file: "embeddings_stance.npz"
  metadata_file: "metadata.jsonl"
  compress: true
  dtype: "float16"
  hf_push: true                                      # push processed batches to HF dataset

# === Identifier and hashing scheme ===
ids:
  scheme: "domain-slug-sha12"
  hash: "sha256"
  normalize_whitespace: true
  lowercase: true
  include_timestamp: true

# === Chroma persistence and similarity metric ===
chroma:
  dir: "chroma_db"
  distance_metric: "cosine"
  rebuild_if_missing: true

# === Logging, diagnostics, and recovery ===
logging:
  level: "INFO"
  save_dir: "logs"
  record_failures: true
  checkpoint_interval: 100

# === Diagnostics and validation ===
diagnostics:
  validate_embeddings: true
  sample_summary_preview: true
  max_preview_chars: 500
  verify_stance_variants: true                       # ensure both label and summary vectors exist
  check_json_integrity: true                         # confirm ideological JSONs load correctly
